(()=>{function e(){const e={};for(let t=0;t<sessionStorage.length;t++){const n=sessionStorage.key(t);e[n]=sessionStorage.getItem(n)}return e}console.log("Panel.js is loading..."),document.addEventListener("DOMContentLoaded",(async function(){console.log("DOM Content Loaded");const t=document.getElementById("refresh"),n=document.getElementById("storage-list"),o=document.getElementById("status");if(!t||!n||!o)return void console.error("Some elements were not found!");function c(e,t="info"){console.log("Status:",e,"Type:",t),o.textContent=e,o.className=t,setTimeout((()=>{o.textContent="",o.className=""}),3e3)}function r(e,t){return`\n// ä¼šè¯å­˜å‚¨æ•°æ®å¯¼å…¥è„šæœ¬ - æ¥è‡ª ${t}\n(function() {\n  const data = ${JSON.stringify(e,null,2)};\n  Object.entries(data).forEach(([key, value]) => {\n    try {\n      sessionStorage.setItem(key, value);\n      console.log('âœ… æˆåŠŸå¯¼å…¥:', key);\n    } catch (error) {\n      console.error('âŒ å¯¼å…¥å¤±è´¥:', key, error);\n    }\n  });\n  console.log('ğŸ‰ å¯¼å…¥å®Œæˆï¼');\n})();`}console.log("All elements found successfully");let a=0;async function i(){try{await async function(e){try{return await e()}catch(t){if(console.error("æ“ä½œå¤±è´¥:",t),(t.message.includes("Extension context invalidated")||t.message.includes("Extension disconnected"))&&(s("æ‰©å±•è¿æ¥å·²æ–­å¼€ï¼Œæ­£åœ¨é‡æ–°è¿æ¥...","warning"),await async function(){if(a>=3)return s("æ‰©å±•è¿æ¥å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•","error"),a=0,!1;a++,await new Promise((e=>setTimeout(e,1e3)));try{return await new Promise(((e,t)=>{try{chrome.runtime.getBackgroundPage((n=>{chrome.runtime.lastError||!n?t(new Error("Extension disconnected")):e(!0)}))}catch(e){t(e)}})),a=0,!0}catch(e){return console.log(`é‡è¿å°è¯• ${a}/3 å¤±è´¥`),!1}}()))try{return await e()}catch(e){throw e}throw t}}((async()=>{n.innerHTML="";const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!t)throw new Error("æ²¡æœ‰æ‰¾åˆ°æ´»åŠ¨æ ‡ç­¾é¡µ");const o=document.createElement("h2");o.textContent="ä¼šè¯å­˜å‚¨æ•°æ®",n.appendChild(o),function(e,t){if(!e||0===e.length){const e=document.createElement("div");return e.textContent="æ²¡æœ‰ä¼šè¯å­˜å‚¨æ•°æ®",void n.appendChild(e)}const o={};if(e.forEach((e=>{if(!e.result||0===Object.keys(e.result).length)return;const a=document.createElement("div");a.className="frame-data";const s=document.createElement("h3");s.textContent=0===e.frameId?"ä¸»æ¡†æ¶":`æ¡†æ¶ ${e.frameId}`,a.appendChild(s);const l=document.createElement("table");l.innerHTML="\n        <tr>\n          <th>é”®</th>\n          <th>å€¼</th>\n          <th>æ“ä½œ</th>\n        </tr>\n      ",Object.entries(e.result).forEach((([e,n])=>{o[e]=n;const a=document.createElement("tr"),s=document.createElement("td");s.textContent=e,a.appendChild(s);const d=document.createElement("td");d.textContent=n,a.appendChild(d);const m=document.createElement("td"),u=document.createElement("button");u.textContent="å¤åˆ¶",u.onclick=()=>{const t=r({[e]:n},"å•ä¸ªé¡¹ç›®");navigator.clipboard.writeText(t),c("ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿","success")},m.appendChild(u);const h=document.createElement("button");h.textContent="æ‰§è¡Œ",h.onclick=async()=>{try{await chrome.scripting.executeScript({target:{tabId:t.id},function:(e,t)=>{sessionStorage.setItem(e,t)},args:[e,n]}),c("æ•°æ®å·²æˆåŠŸè®¾ç½®åˆ°ä¼šè¯å­˜å‚¨","success")}catch(e){console.error("æ‰§è¡Œå¤±è´¥:",e),c("æ‰§è¡Œå¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦æƒ…","error")}},m.appendChild(h);const p=document.createElement("button");p.textContent="åˆ é™¤",p.onclick=async()=>{try{await chrome.scripting.executeScript({target:{tabId:t.id},function:e=>{sessionStorage.removeItem(e)},args:[e]}),c(`å·²åˆ é™¤é”® "${e}"`,"success"),i()}catch(e){console.error("åˆ é™¤å¤±è´¥:",e),c("åˆ é™¤å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦æƒ…","error")}},m.appendChild(p),a.appendChild(m),l.appendChild(a)})),a.appendChild(l),n.appendChild(a)})),Object.keys(o).length>0){const e=document.createElement("div");e.className="batch-operations";const a=document.createElement("button");a.textContent="å¤åˆ¶æ‰€æœ‰ä¼šè¯å­˜å‚¨",a.onclick=()=>{const e=r(o,"æ‰€æœ‰ä¼šè¯å­˜å‚¨");navigator.clipboard.writeText(e),c("æ‰€æœ‰ä¼šè¯å­˜å‚¨æ•°æ®çš„ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿","success")},e.appendChild(a);const s=document.createElement("button");s.textContent="å¯¼å…¥æ‰€æœ‰ä¼šè¯å­˜å‚¨",s.onclick=async()=>{try{await chrome.scripting.executeScript({target:{tabId:t.id},function:e=>{Object.entries(e).forEach((([e,t])=>{try{sessionStorage.setItem(e,t),console.log("âœ… æˆåŠŸå¯¼å…¥:",e)}catch(t){console.error("âŒ å¯¼å…¥å¤±è´¥:",e,t)}}))},args:[o]}),c("æ‰€æœ‰ä¼šè¯å­˜å‚¨æ•°æ®å·²å¯¼å…¥","success")}catch(e){console.error("å¯¼å…¥æ‰€æœ‰æ•°æ®å¤±è´¥:",e),c("å¯¼å…¥å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦æƒ…","error")}},e.appendChild(s);const l=document.createElement("button");l.textContent="åˆ é™¤æ‰€æœ‰ä¼šè¯å­˜å‚¨",l.onclick=async()=>{try{await chrome.scripting.executeScript({target:{tabId:t.id},function:()=>{sessionStorage.clear()}}),c("æ‰€æœ‰ä¼šè¯å­˜å‚¨æ•°æ®å·²åˆ é™¤","success"),i()}catch(e){console.error("åˆ é™¤æ‰€æœ‰æ•°æ®å¤±è´¥:",e),c("åˆ é™¤å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦æƒ…","error")}},e.appendChild(l),n.appendChild(e)}}(await chrome.scripting.executeScript({target:{tabId:t.id,allFrames:!0},function:e}),t);const a=document.createElement("h2");a.textContent="Cookieæ•°æ®",n.appendChild(a),await async function(e){try{const t=new URL(e.url),o=await chrome.cookies.getAll({domain:t.hostname});if(!o||0===o.length){const e=document.createElement("div");return e.textContent="æ²¡æœ‰Cookieæ•°æ®",void n.appendChild(e)}const r=document.createElement("table");r.innerHTML="\n        <tr>\n          <th>åç§°</th>\n          <th>å€¼</th>\n          <th>åŸŸ</th>\n          <th>è·¯å¾„</th>\n          <th>è¿‡æœŸæ—¶é—´</th>\n          <th>æ“ä½œ</th>\n        </tr>\n      ",o.forEach((t=>{const n=document.createElement("tr"),o=e=>{const t=document.createElement("td");t.textContent=e,n.appendChild(t)};o(t.name),o(t.value),o(t.domain),o(t.path),o(t.expirationDate?new Date(1e3*t.expirationDate).toLocaleString():"ä¼šè¯ç»“æŸæ—¶");const a=document.createElement("td"),s=document.createElement("button");s.textContent="å¤åˆ¶",s.onclick=()=>{const n=`\n            chrome.cookies.set({\n              url: "${e.url}",\n              name: "${t.name}",\n              value: "${t.value}",\n              domain: "${t.domain}",\n              path: "${t.path}",\n              secure: ${t.secure},\n              httpOnly: ${t.httpOnly},\n              sameSite: "${t.sameSite}",\n              ${t.expirationDate?`expirationDate: ${t.expirationDate},`:""}\n            });\n          `;navigator.clipboard.writeText(n),c("Cookieä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")},a.appendChild(s);const l=document.createElement("button");l.textContent="åˆ é™¤",l.onclick=async()=>{try{await chrome.cookies.remove({url:e.url,name:t.name}),c(`Cookie "${t.name}" å·²åˆ é™¤`),i()}catch(e){console.error("åˆ é™¤Cookieå¤±è´¥:",e),c("åˆ é™¤Cookieå¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦æƒ…","error")}},a.appendChild(l),n.appendChild(a),r.appendChild(n)}));const a=document.createElement("div");a.className="batch-operations";const s=document.createElement("button");s.textContent="å¤åˆ¶æ‰€æœ‰Cookie",s.onclick=()=>{const t=o.map((t=>`\n          chrome.cookies.set({\n            url: "${e.url}",\n            name: "${t.name}",\n            value: "${t.value}",\n            domain: "${t.domain}",\n            path: "${t.path}",\n            secure: ${t.secure},\n            httpOnly: ${t.httpOnly},\n            sameSite: "${t.sameSite}",\n            ${t.expirationDate?`expirationDate: ${t.expirationDate},`:""}\n          });\n        `)).join("\n");navigator.clipboard.writeText(t),c("æ‰€æœ‰Cookieä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")},a.appendChild(s);const l=document.createElement("button");l.textContent="åˆ é™¤æ‰€æœ‰Cookie",l.onclick=async()=>{try{for(const t of o)await chrome.cookies.remove({url:e.url,name:t.name});c("æ‰€æœ‰Cookieå·²åˆ é™¤"),i()}catch(e){console.error("åˆ é™¤æ‰€æœ‰Cookieå¤±è´¥:",e),c("åˆ é™¤Cookieå¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦æƒ…","error")}},a.appendChild(l),n.appendChild(r),n.appendChild(a)}catch(e){console.error("æ˜¾ç¤ºCookieæ•°æ®å¤±è´¥:",e),c("æ˜¾ç¤ºCookieæ•°æ®å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦æƒ…","error")}}(t)}))}catch(e){console.error("åˆ·æ–°æ•°æ®å¤±è´¥:",e),c("åˆ·æ–°æ•°æ®å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦æƒ…","error")}}function s(e,t="info"){const n=document.getElementById("toast");n&&(n.textContent=e,n.className=`toast toast-${t} show`,setTimeout((()=>{n.className=n.className.replace("show","")}),3e3))}t.addEventListener("click",i),console.log("Initial data load"),i()}))})();