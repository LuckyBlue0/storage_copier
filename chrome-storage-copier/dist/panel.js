(()=>{function e(){const e={};for(let t=0;t<sessionStorage.length;t++){const n=sessionStorage.key(t);e[n]=sessionStorage.getItem(n)}return e}console.log("Panel.js is loading..."),document.addEventListener("DOMContentLoaded",(async function(){console.log("DOM Content Loaded");const t=document.getElementById("refresh"),n=document.getElementById("storage-list"),o=document.getElementById("status");if(!t||!n||!o)return void console.error("Some elements were not found!");function c(e,t="info"){console.log("Status:",e,"Type:",t),o.textContent=e,o.className=t,setTimeout((()=>{o.textContent="",o.className=""}),3e3)}function r(e,t){return`\n// 会话存储数据导入脚本 - 来自 ${t}\n(function() {\n  const data = ${JSON.stringify(e,null,2)};\n  Object.entries(data).forEach(([key, value]) => {\n    try {\n      sessionStorage.setItem(key, value);\n      console.log('✅ 成功导入:', key);\n    } catch (error) {\n      console.error('❌ 导入失败:', key, error);\n    }\n  });\n  console.log('🎉 导入完成！');\n})();`}console.log("All elements found successfully");let a=0;async function i(){try{await async function(e){try{return await e()}catch(t){if(console.error("操作失败:",t),(t.message.includes("Extension context invalidated")||t.message.includes("Extension disconnected"))&&(s("扩展连接已断开，正在重新连接...","warning"),await async function(){if(a>=3)return s("扩展连接失败，请刷新页面重试","error"),a=0,!1;a++,await new Promise((e=>setTimeout(e,1e3)));try{return await new Promise(((e,t)=>{try{chrome.runtime.getBackgroundPage((n=>{chrome.runtime.lastError||!n?t(new Error("Extension disconnected")):e(!0)}))}catch(e){t(e)}})),a=0,!0}catch(e){return console.log(`重连尝试 ${a}/3 失败`),!1}}()))try{return await e()}catch(e){throw e}throw t}}((async()=>{n.innerHTML="";const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!t)throw new Error("没有找到活动标签页");const o=document.createElement("h2");o.textContent="会话存储数据",n.appendChild(o),function(e,t){if(!e||0===e.length){const e=document.createElement("div");return e.textContent="没有会话存储数据",void n.appendChild(e)}const o={};if(e.forEach((e=>{if(!e.result||0===Object.keys(e.result).length)return;const a=document.createElement("div");a.className="frame-data";const s=document.createElement("h3");s.textContent=0===e.frameId?"主框架":`框架 ${e.frameId}`,a.appendChild(s);const l=document.createElement("table");l.innerHTML="\n        <tr>\n          <th>键</th>\n          <th>值</th>\n          <th>操作</th>\n        </tr>\n      ",Object.entries(e.result).forEach((([e,n])=>{o[e]=n;const a=document.createElement("tr"),s=document.createElement("td");s.textContent=e,a.appendChild(s);const d=document.createElement("td");d.textContent=n,a.appendChild(d);const m=document.createElement("td"),u=document.createElement("button");u.textContent="复制",u.onclick=()=>{const t=r({[e]:n},"单个项目");navigator.clipboard.writeText(t),c("代码已复制到剪贴板","success")},m.appendChild(u);const h=document.createElement("button");h.textContent="执行",h.onclick=async()=>{try{await chrome.scripting.executeScript({target:{tabId:t.id},function:(e,t)=>{sessionStorage.setItem(e,t)},args:[e,n]}),c("数据已成功设置到会话存储","success")}catch(e){console.error("执行失败:",e),c("执行失败，请查看控制台了解详情","error")}},m.appendChild(h);const p=document.createElement("button");p.textContent="删除",p.onclick=async()=>{try{await chrome.scripting.executeScript({target:{tabId:t.id},function:e=>{sessionStorage.removeItem(e)},args:[e]}),c(`已删除键 "${e}"`,"success"),i()}catch(e){console.error("删除失败:",e),c("删除失败，请查看控制台了解详情","error")}},m.appendChild(p),a.appendChild(m),l.appendChild(a)})),a.appendChild(l),n.appendChild(a)})),Object.keys(o).length>0){const e=document.createElement("div");e.className="batch-operations";const a=document.createElement("button");a.textContent="复制所有会话存储",a.onclick=()=>{const e=r(o,"所有会话存储");navigator.clipboard.writeText(e),c("所有会话存储数据的代码已复制到剪贴板","success")},e.appendChild(a);const s=document.createElement("button");s.textContent="导入所有会话存储",s.onclick=async()=>{try{await chrome.scripting.executeScript({target:{tabId:t.id},function:e=>{Object.entries(e).forEach((([e,t])=>{try{sessionStorage.setItem(e,t),console.log("✅ 成功导入:",e)}catch(t){console.error("❌ 导入失败:",e,t)}}))},args:[o]}),c("所有会话存储数据已导入","success")}catch(e){console.error("导入所有数据失败:",e),c("导入失败，请查看控制台了解详情","error")}},e.appendChild(s);const l=document.createElement("button");l.textContent="删除所有会话存储",l.onclick=async()=>{try{await chrome.scripting.executeScript({target:{tabId:t.id},function:()=>{sessionStorage.clear()}}),c("所有会话存储数据已删除","success"),i()}catch(e){console.error("删除所有数据失败:",e),c("删除失败，请查看控制台了解详情","error")}},e.appendChild(l),n.appendChild(e)}}(await chrome.scripting.executeScript({target:{tabId:t.id,allFrames:!0},function:e}),t);const a=document.createElement("h2");a.textContent="Cookie数据",n.appendChild(a),await async function(e){try{const t=new URL(e.url),o=await chrome.cookies.getAll({domain:t.hostname});if(!o||0===o.length){const e=document.createElement("div");return e.textContent="没有Cookie数据",void n.appendChild(e)}const r=document.createElement("table");r.innerHTML="\n        <tr>\n          <th>名称</th>\n          <th>值</th>\n          <th>域</th>\n          <th>路径</th>\n          <th>过期时间</th>\n          <th>操作</th>\n        </tr>\n      ",o.forEach((t=>{const n=document.createElement("tr"),o=e=>{const t=document.createElement("td");t.textContent=e,n.appendChild(t)};o(t.name),o(t.value),o(t.domain),o(t.path),o(t.expirationDate?new Date(1e3*t.expirationDate).toLocaleString():"会话结束时");const a=document.createElement("td"),s=document.createElement("button");s.textContent="复制",s.onclick=()=>{const n=`\n            chrome.cookies.set({\n              url: "${e.url}",\n              name: "${t.name}",\n              value: "${t.value}",\n              domain: "${t.domain}",\n              path: "${t.path}",\n              secure: ${t.secure},\n              httpOnly: ${t.httpOnly},\n              sameSite: "${t.sameSite}",\n              ${t.expirationDate?`expirationDate: ${t.expirationDate},`:""}\n            });\n          `;navigator.clipboard.writeText(n),c("Cookie代码已复制到剪贴板")},a.appendChild(s);const l=document.createElement("button");l.textContent="删除",l.onclick=async()=>{try{await chrome.cookies.remove({url:e.url,name:t.name}),c(`Cookie "${t.name}" 已删除`),i()}catch(e){console.error("删除Cookie失败:",e),c("删除Cookie失败，请查看控制台了解详情","error")}},a.appendChild(l),n.appendChild(a),r.appendChild(n)}));const a=document.createElement("div");a.className="batch-operations";const s=document.createElement("button");s.textContent="复制所有Cookie",s.onclick=()=>{const t=o.map((t=>`\n          chrome.cookies.set({\n            url: "${e.url}",\n            name: "${t.name}",\n            value: "${t.value}",\n            domain: "${t.domain}",\n            path: "${t.path}",\n            secure: ${t.secure},\n            httpOnly: ${t.httpOnly},\n            sameSite: "${t.sameSite}",\n            ${t.expirationDate?`expirationDate: ${t.expirationDate},`:""}\n          });\n        `)).join("\n");navigator.clipboard.writeText(t),c("所有Cookie代码已复制到剪贴板")},a.appendChild(s);const l=document.createElement("button");l.textContent="删除所有Cookie",l.onclick=async()=>{try{for(const t of o)await chrome.cookies.remove({url:e.url,name:t.name});c("所有Cookie已删除"),i()}catch(e){console.error("删除所有Cookie失败:",e),c("删除Cookie失败，请查看控制台了解详情","error")}},a.appendChild(l),n.appendChild(r),n.appendChild(a)}catch(e){console.error("显示Cookie数据失败:",e),c("显示Cookie数据失败，请查看控制台了解详情","error")}}(t)}))}catch(e){console.error("刷新数据失败:",e),c("刷新数据失败，请查看控制台了解详情","error")}}function s(e,t="info"){const n=document.getElementById("toast");n&&(n.textContent=e,n.className=`toast toast-${t} show`,setTimeout((()=>{n.className=n.className.replace("show","")}),3e3))}t.addEventListener("click",i),console.log("Initial data load"),i()}))})();