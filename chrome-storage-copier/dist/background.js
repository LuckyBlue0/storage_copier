(()=>{async function e(){console.log("ğŸš€ getSessionStorageData å¼€å§‹æ‰§è¡Œ");const e={},o=window.location.href;console.log(`ğŸ” å½“å‰frame URL: ${o}`);try{if("undefined"==typeof sessionStorage)return void console.error("âŒ sessionStorage ä¸å¯ç”¨");console.log(`ğŸ“Š sessionStorage.length = ${sessionStorage.length}`);for(let o=0;o<sessionStorage.length;o++){const t=sessionStorage.key(o);e[t]=sessionStorage.getItem(t)}if(console.log("ğŸ“¦ æ”¶é›†åˆ°çš„æ•°æ®:",e),Object.keys(e).length>0){console.log(`âœ… æˆåŠŸæ”¶é›† ${o} çš„æ•°æ®:`,Object.keys(e).length,"ä¸ªé¡¹ç›®");try{console.log("ğŸ“¤ æ­£åœ¨å‘é€æ¶ˆæ¯åˆ°background...");const t=await chrome.runtime.sendMessage({action:"saveSessionStorage",data:e,frameUrl:o});console.log("ğŸ“« æ¶ˆæ¯å‘é€ç»“æœ:",t)}catch(t){console.error("âŒ å‘é€æ¶ˆæ¯å¤±è´¥:",t);try{console.log("ğŸ”„ å°è¯•ç›´æ¥ä¿å­˜åˆ°storage..."),await chrome.storage.local.set({[`sessionStorage_${o}`]:e}),console.log("âœ… ç›´æ¥ä¿å­˜æˆåŠŸ")}catch(e){console.error("âŒ ç›´æ¥ä¿å­˜ä¹Ÿå¤±è´¥:",e)}}}else console.log(`â„¹ï¸ ${o} æ²¡æœ‰sessionStorageæ•°æ®`)}catch(e){console.error("âŒ æ”¶é›†æ•°æ®å¤±è´¥:",e)}}async function o(e){console.log("ğŸš€ importSessionStorageData å¼€å§‹æ‰§è¡Œ");const o=window.location.href;console.log(`ğŸ” å½“å‰frame URL: ${o}`),console.log("ğŸ“¦ æ”¶åˆ°çš„æ•°æ®:",e);try{if("undefined"==typeof sessionStorage)return void console.error("âŒ sessionStorage ä¸å¯ç”¨");let o={};if(Object.values(e).forEach((e=>{Object.entries(e).forEach((([e,t])=>{o[e]=t}))})),0===Object.keys(o).length)return void console.log("âš ï¸ æ²¡æœ‰æ‰¾åˆ°ä»»ä½•å¯å¯¼å…¥çš„æ•°æ®");console.log("ğŸ“¥ å‡†å¤‡å¯¼å…¥çš„åˆå¹¶æ•°æ®:",o),console.log("ğŸ—‘ï¸ æ¸…ç©ºå½“å‰sessionStorage"),sessionStorage.clear();let t=0,s=0;for(const[e,n]of Object.entries(o))try{sessionStorage.setItem(e,n),console.log(`âœ… æˆåŠŸå¯¼å…¥: ${e} = ${n}`),t++}catch(o){console.error(`âŒ å¯¼å…¥å¤±è´¥: ${e}`,o),s++}console.log(`ğŸ‰ å¯¼å…¥å®Œæˆï¼æˆåŠŸ: ${t} ä¸ªï¼Œå¤±è´¥: ${s} ä¸ª`);const n={};for(let e=0;e<sessionStorage.length;e++){const o=sessionStorage.key(e);n[o]=sessionStorage.getItem(o)}console.log("ğŸ“Š å¯¼å…¥åçš„sessionStorageå†…å®¹:",n)}catch(e){console.error("âŒ å¯¼å…¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:",e)}}chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus.create({id:"copySessionStorage",title:"å¤åˆ¶ä¼šè¯å­˜å‚¨æ•°æ®",contexts:["page","frame"]}),chrome.contextMenus.create({id:"importSessionStorage",title:"å¯¼å…¥ä¼šè¯å­˜å‚¨æ•°æ®",contexts:["page","frame"]})})),chrome.commands.onCommand.addListener((t=>{console.log("Command received:",t),"copy-session-storage"===t?(console.log("ğŸ¯ é€šè¿‡å¿«æ·é”®è§¦å‘å¤åˆ¶æ“ä½œ"),chrome.tabs.query({active:!0,currentWindow:!0},(async function(o){o[0]?(await chrome.scripting.executeScript({target:{tabId:o[0].id,allFrames:!0},function:e}),await s("æ•°æ®å¤åˆ¶æˆåŠŸï¼","success")):console.error("âŒ æ²¡æœ‰æ‰¾åˆ°æ´»åŠ¨æ ‡ç­¾é¡µ")}))):"import-session-storage"===t&&(console.log("ğŸ¯ é€šè¿‡å¿«æ·é”®è§¦å‘å¯¼å…¥æ“ä½œ"),chrome.tabs.query({active:!0,currentWindow:!0},(async function(e){e[0]?chrome.storage.local.get(null,(async function(t){console.log("ğŸ“¦ storageä¸­çš„æ‰€æœ‰æ•°æ®:",t);const n={};if(Object.entries(t).forEach((([e,o])=>{if("sessionStorageData"===e)Object.assign(n,o);else if(e.startsWith("sessionStorage_")){const t=e.replace("sessionStorage_","");n[t]=o}})),Object.keys(n).length>0){console.log("ğŸ“¦ å‡†å¤‡å¯¼å…¥çš„æ•°æ®:",n);try{const t=await chrome.scripting.executeScript({target:{tabId:e[0].id,allFrames:!0},function:o,args:[n]});console.log("ğŸ“Š å¯¼å…¥è„šæœ¬æ‰§è¡Œç»“æœ:",t),await s("æ•°æ®å¯¼å…¥æˆåŠŸï¼","success")}catch(e){console.error("âŒ æ‰§è¡Œå¯¼å…¥è„šæœ¬å¤±è´¥:",e),await s("å¯¼å…¥å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦æƒ…","error")}}else console.log("âš ï¸ æ²¡æœ‰æ‰¾åˆ°è¦å¯¼å…¥çš„æ•°æ®"),await s("æ²¡æœ‰æ‰¾åˆ°å¯å¯¼å…¥çš„æ•°æ®","error")})):console.error("âŒ æ²¡æœ‰æ‰¾åˆ°æ´»åŠ¨æ ‡ç­¾é¡µ")})))}));let t={};async function s(e,o){const t=await chrome.tabs.query({active:!0,currentWindow:!0});t[0]&&await chrome.scripting.executeScript({target:{tabId:t[0].id,allFrames:!0},function:(e,o)=>{function t(e,o){const t=document.getElementById("chrome-storage-copier-toast");t&&t.remove();const s=document.createElement("div");s.id="chrome-storage-copier-toast",s.style.cssText=`\n            position: fixed;\n            left: 50%;\n            top: 50%;\n            transform: translate(-50%, -50%) scale(0.8);\n            padding: 12px 20px;\n            min-width: 160px;\n            max-width: 60%;\n            background-color: ${"success"===o?"#4caf50":"error"===o?"#f44336":"#2196f3"};\n            color: white;\n            border-radius: 6px;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n            z-index: 10000;\n            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n            font-size: 14px;\n            text-align: center;\n            opacity: 0;\n            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n          `;const n=document.createElement("div");n.style.cssText="\n            font-size: 20px;\n            margin-bottom: 4px;\n          ",n.textContent="success"===o?"âœ…":"error"===o?"âŒ":"â„¹ï¸",s.appendChild(n);const r=document.createElement("div");r.style.cssText="\n            line-height: 1.4;\n            word-break: break-word;\n          ",r.textContent=e,s.appendChild(r),document.body.appendChild(s),requestAnimationFrame((()=>{s.style.opacity="1",s.style.transform="translate(-50%, -50%) scale(1)"})),setTimeout((()=>{s.style.opacity="0",s.style.transform="translate(-50%, -50%) scale(0.8)",setTimeout((()=>{s.remove()}),300)}),3e3)}"complete"===document.readyState?t(e,o):window.addEventListener("load",(()=>{t(e,o)}))},args:[e,o]})}chrome.contextMenus.onClicked.addListener((async(n,r)=>{if("copySessionStorage"===n.menuItemId){console.log("ğŸ¯ è§¦å‘å¤åˆ¶æ“ä½œ"),t={};try{const o=await chrome.scripting.executeScript({target:{tabId:r.id,allFrames:!0},function:e});console.log("ğŸ“Š è„šæœ¬æ‰§è¡Œç»“æœ:",o)}catch(e){console.error("âŒ æ‰§è¡Œè„šæœ¬å¤±è´¥:",e),await s("å¤åˆ¶å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦æƒ…","error")}}else"importSessionStorage"===n.menuItemId&&(console.log("ğŸ¯ è§¦å‘å¯¼å…¥æ“ä½œ"),chrome.storage.local.get(null,(async function(e){console.log("ğŸ“¦ storageä¸­çš„æ‰€æœ‰æ•°æ®:",e);const t={};if(Object.entries(e).forEach((([e,o])=>{if("sessionStorageData"===e)Object.assign(t,o);else if(e.startsWith("sessionStorage_")){const s=e.replace("sessionStorage_","");t[s]=o}})),Object.keys(t).length>0){console.log("ğŸ“¦ å‡†å¤‡å¯¼å…¥çš„æ•°æ®:",t);try{const e=await chrome.scripting.executeScript({target:{tabId:r.id,allFrames:!0},function:o,args:[t]});console.log("ğŸ“Š å¯¼å…¥è„šæœ¬æ‰§è¡Œç»“æœ:",e)}catch(e){console.error("âŒ æ‰§è¡Œå¯¼å…¥è„šæœ¬å¤±è´¥:",e),await s("å¯¼å…¥å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦æƒ…","error")}}else console.log("âš ï¸ æ²¡æœ‰æ‰¾åˆ°è¦å¯¼å…¥çš„æ•°æ®"),await s("æ²¡æœ‰æ‰¾åˆ°å¯å¯¼å…¥çš„æ•°æ®","error")})))})),chrome.runtime.onMessage.addListener(((e,o,s)=>(console.log("ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯:",e),"saveSessionStorage"===e.action&&(console.log(`ğŸ“¥ æ”¶åˆ°æ¥è‡ª ${e.frameUrl} çš„æ•°æ®:`,e.data),Object.keys(e.data).length>0&&(t[e.frameUrl]=e.data,console.log("ğŸ“¦ å½“å‰æ”¶é›†çš„æ‰€æœ‰æ•°æ®:",t),setTimeout((()=>{Object.keys(t).length>0&&(console.log("ğŸ’¾ æ­£åœ¨ä¿å­˜æ‰€æœ‰æ”¶é›†çš„æ•°æ®..."),chrome.storage.local.set({sessionStorageData:t},(function(){console.log('âœ… æ•°æ®å·²ä¿å­˜ï¼ç°åœ¨å¯ä»¥åœ¨ç›®æ ‡é¡µé¢å³é”®é€‰æ‹©"å¯¼å…¥ä¼šè¯å­˜å‚¨æ•°æ®"'),console.log("ğŸ“Š å·²ä¿å­˜çš„æ•°æ®ç»“æ„:",t),t={}})))}),500))),s({received:!0}),!0)))})();